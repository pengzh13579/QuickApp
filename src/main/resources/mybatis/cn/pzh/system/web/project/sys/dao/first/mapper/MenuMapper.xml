<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.pzh.system.web.project.sys.dao.mapper.MenuMapper">

    <resultMap id="MenuNodeMap" type="cn.pzh.system.web.project.common.dao.first.entity.SystemMenuEntity" >
        <result column="MENU_CODE" property="menuCode" jdbcType="VARCHAR" />
        <result column="MENU_NAME" property="menuName" jdbcType="VARCHAR" />
        <result column="MENU_URL" property="menuUrl" jdbcType="VARCHAR" />
    </resultMap>

    <!-- 开启基于redis的二级缓存 -->
    <cache type="cn.pzh.system.web.project.common.conf.redis.RedisCache"/>

    <!--  -->
    <select id="getMenu" parameterType="map" resultMap="MenuNodeMap">
        SELECT
            A.MENU_CODE,
            A.MENU_NAME,
            A.MENU_URL
        FROM sys_menu A
        INNER JOIN sys_menu_role B
        ON A.I_ID = B.MENU_ID
        INNER JOIN sys_role C
        ON B.ROLE_ID = C.I_ID
        AND C.DIS_FLAG = 0
        INNER JOIN t_b_role_user_mapping D
        ON C.I_ID = D.ROLE_ID
        INNER JOIN t_b_user E
        ON E.I_ID = D.USER_ID
        WHERE A.PARENT_MENU_CODE = #{parentMenuCode,jdbcType=VARCHAR}
        AND A.DIS_FLAG = 0
        AND E.USER_NAME = #{userName,jdbcType=VARCHAR}
        ORDER BY MENU_CODE ASC
    </select>
</mapper>
